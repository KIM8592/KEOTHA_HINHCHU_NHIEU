<!DOCTYPE html>
<html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hệ thống Kiểm phiếu Tín nhiệm</title>
<script src="https://cdn.tailwindcss.com"></script>
<style>
html,body{height:100%;margin:0;overflow:hidden;font-family:Inter,sans-serif;background:#f1f5f9}
.vote-btn.active-0{background:#10b981;color:#fff}
.vote-btn.active-1{background:#ef4444;color:#fff}
.vote-btn.active-2{background:#6b7280;color:#fff}
.scroll-area{flex:1;overflow-y:auto;padding:1rem}
.result-table{border-collapse:collapse;width:100%;border:2px solid #000}
.result-table th,.result-table td{border:1px solid #000;padding:6px;text-align:center}
.candidate-name-cell{text-align:left;font-weight:700}
.author-fixed{
  position:fixed;
  bottom:10px;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  font-weight:700;
  opacity:0.4;
  pointer-events:none;
  z-index:9999;
  text-transform:uppercase;
  letter-spacing:1px;
}

</style>
</head>

<body class="flex items-center justify-center">
<div class="w-full max-w-4xl h-full bg-white shadow-2xl rounded-2xl flex flex-col">

<header class="p-4 border-b text-center">
  <h1 class="font-black text-xl">KIỂM PHIẾU TÍN NHIỆM</h1>
</header>

<main class="scroll-area">

<section id="step-1">
  <input id="input-name" class="border px-3 py-2 rounded w-full" placeholder="Họ và tên">
  <button onclick="addCandidate()" class="mt-2 bg-blue-600 text-white px-4 py-2 rounded w-full">THÊM</button>
  <ul id="list-names" class="mt-4"></ul>
</section>

<section id="step-2" class="hidden">
  <div class="font-bold mb-2">PHIẾU: <span id="idx-display"></span></div>
  <div id="vote-list"></div>
</section>

<section id="step-3" class="hidden">
  <h2 class="font-black text-lg mb-2 text-center">KẾT QUẢ</h2>
  <table class="result-table">
    <thead>
      <tr>
        <th>STT</th><th>Ứng cử viên</th>
        <th>Tín nhiệm</th><th>Không TN</th><th>Không HL</th><th>Tổng</th>
      </tr>
    </thead>
    <tbody id="table-results"></tbody>
  </table>

  <!-- XEM LẠI PHIẾU -->
  <div class="mt-6 p-4 bg-slate-50 rounded-xl">
    <h3 class="font-bold mb-2">XEM LẠI PHIẾU ĐÃ TÍCH</h3>
    <div class="flex gap-2">
      <input id="review-input" type="number" class="border px-3 py-2 rounded w-32" placeholder="Số phiếu">
      <button onclick="reviewBallot()" class="bg-emerald-600 text-white px-4 rounded">XEM</button>
    </div>
    <div id="review-result" class="mt-3 text-sm"></div>
  </div>

  <!-- RESET -->
  <div class="mt-6 text-center">
    <button onclick="resetAll()" class="bg-red-600 text-white px-6 py-3 rounded-xl font-bold">
      RESET – KIỂM TRA MỚI
    </button>
  </div>
</section>

</main>

<footer class="p-4 border-t">
  <button onclick="start()" id="btn-start" class="hidden bg-emerald-600 text-white w-full py-3 rounded">BẮT ĐẦU</button>
  <button onclick="confirmVote()" id="btn-confirm" class="hidden bg-blue-600 text-white w-full py-3 rounded">XÁC NHẬN</button>
  <button onclick="finish()" id="btn-finish" class="hidden bg-red-500 text-white w-full py-3 rounded">KẾT THÚC</button>
</footer>

</div>

<script>
let state={
  candidates:[],
  voteIndex:1,
  step:1,
  selections:{},
  ballots:[]
};

function save(){localStorage.setItem("kp",JSON.stringify(state));render()}
function load(){const d=localStorage.getItem("kp");if(d)state=JSON.parse(d);render()}

function render(){
  ["step-1","step-2","step-3"].forEach((id,i)=>{
    document.getElementById(id).classList.toggle("hidden",state.step!==i+1)
  })
  btn("btn-start",state.step==1&&state.candidates.length)
  btn("btn-confirm",state.step==2)
  btn("btn-finish",state.step==2)

  document.getElementById("idx-display").innerText=state.voteIndex

  document.getElementById("list-names").innerHTML=state.candidates.map((c,i)=>`
    <li>${i+1}. ${c.name}</li>`).join("")

  document.getElementById("vote-list").innerHTML=state.candidates.map(c=>`
    <div class="mb-2">
      <b>${c.name}</b>
      <div class="grid grid-cols-3 gap-1">
        ${voteBtn(c.id,0,"TN")}
        ${voteBtn(c.id,1,"K.TN")}
        ${voteBtn(c.id,2,"K.HL")}
      </div>
    </div>`).join("")

  document.getElementById("table-results").innerHTML=state.candidates.map((c,i)=>{
    const t=state.voteIndex-1||1
    return `<tr>
      <td>${i+1}</td>
      <td class="candidate-name-cell">${c.name}</td>
      <td>${c.scores[0]} (${(c.scores[0]/t*100).toFixed(1)}%)</td>
      <td>${c.scores[1]} (${(c.scores[1]/t*100).toFixed(1)}%)</td>
      <td>${c.scores[2]} (${(c.scores[2]/t*100).toFixed(1)}%)</td>
      <td>${t}</td>
    </tr>`
  }).join("")
}

function addCandidate(){
  const v=input("input-name").value.trim();if(!v)return
  state.candidates.push({id:Date.now(),name:v,scores:{0:0,1:0,2:0}})
  input("input-name").value=""
  save()
}
function start(){
  state.step=2
  state.candidates.forEach(c=>state.selections[c.id]=null)
  save()
}
function pick(id,v){state.selections[id]=v;render()}
function confirmVote(){
  if(state.candidates.some(c=>state.selections[c.id]==null))return alert("Chưa đủ!")
  const ballot={}
  state.candidates.forEach(c=>{
    const v=state.selections[c.id]
    c.scores[v]++
    ballot[c.name]=["Tín nhiệm","Không tín nhiệm","Không hợp lệ"][v]
  })
  state.ballots.push(ballot)
  state.voteIndex++
  state.candidates.forEach(c=>state.selections[c.id]=null)
  save()
}
function finish(){state.step=3;save()}

function reviewBallot(){
  const n=parseInt(input("review-input").value)
  const b=state.ballots[n-1]
  if(!b)return alert("Không có phiếu này")
  input("review-result").innerHTML=Object.entries(b).map(
    ([k,v])=>`• <b>${k}</b>: ${v}`
  ).join("<br>")
}

function resetAll(){
  if(!confirm("Xóa toàn bộ dữ liệu để kiểm phiếu mới?"))return
  localStorage.removeItem("kp")
  state={candidates:[],voteIndex:1,step:1,selections:{},ballots:[]}
  save()
}

function voteBtn(id,v,t){
  return `<button onclick="pick(${id},${v})"
  class="vote-btn py-1 rounded ${state.selections[id]==v?'active-'+v:'bg-slate-200'}">${t}</button>`
}
function input(id){return document.getElementById(id)}
function btn(id,ok){document.getElementById(id).classList.toggle("hidden",!ok)}
// ===== ENTER ĐỂ THÊM + XEM PHIẾU =====
document.addEventListener("keydown",function(e){
  if(e.key!=="Enter") return;

  // Enter để thêm ứng cử viên
  const nameInput=document.getElementById("input-name");
  if(document.activeElement===nameInput){
    e.preventDefault();
    addCandidate();
    return;
  }

  // Enter để xem lại phiếu
  const reviewInput=document.getElementById("review-input");
  if(reviewInput && document.activeElement===reviewInput){
    e.preventDefault();
    reviewBallot();
  }
});

window.onload=load
</script>
<div class="author-fixed">
  Tác giả: <b>Trần Trọng Kim - ĐT: 0964567806</b>
</div>

</body>
</html>
